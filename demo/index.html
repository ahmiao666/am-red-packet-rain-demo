<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é€šç”¨çº¢åŒ…é›¨ç»„ä»¶ - æ¼”ç¤º</title>
    <style>
      body {
        font-family: "Arial", sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        margin: 0;
        font-size: 2.5em;
        font-weight: 700;
      }

      .header p {
        margin: 10px 0 0;
        font-size: 1.2em;
        opacity: 0.9;
      }

      .content {
        padding: 30px;
      }

      .demo-section {
        margin-bottom: 40px;
      }

      .demo-section h2 {
        color: #ff6b6b;
        border-bottom: 2px solid #ff6b6b;
        padding-bottom: 10px;
        margin-bottom: 20px;
      }

      .stats-panel {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
      }

      .stat-item {
        text-align: center;
        padding: 15px;
        background: white;
        border-radius: 6px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .stat-value {
        font-size: 2em;
        font-weight: bold;
        color: #ff6b6b;
      }

      .stat-label {
        color: #666;
        margin-top: 5px;
      }

      .controls {
        margin-bottom: 20px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 25px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .btn-primary {
        background: linear-gradient(45deg, #ff6b6b, #ffa500);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
      }

      .config-panel {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .config-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
      }

      .config-item {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .config-item label {
        min-width: 80px;
        font-weight: 600;
        color: #333;
      }

      .config-item input[type="range"] {
        flex: 1;
        height: 6px;
        background: #ddd;
        border-radius: 3px;
        outline: none;
        appearance: none;
      }

      .config-item input[type="range"]::-webkit-slider-thumb {
        appearance: none;
        width: 20px;
        height: 20px;
        background: #ff6b6b;
        border-radius: 50%;
        cursor: pointer;
      }

      .config-item .value {
        min-width: 30px;
        text-align: center;
        font-weight: bold;
        color: #ff6b6b;
      }

      .canvas-container {
        position: relative;
        border: 3px solid #ff6b6b;
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 20px;
        background: linear-gradient(
          135deg,
          rgba(255, 107, 107, 0.1) 0%,
          rgba(255, 165, 0, 0.1) 100%
        );
      }

      .canvas-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="%23ff6b6b" stroke-width="0.5" opacity="0.3"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        pointer-events: none;
      }

      #redPacketCanvas {
        display: block;
        width: 100%;
        height: 500px;
        position: relative;
        z-index: 1;
      }

      .instructions {
        background: linear-gradient(135deg, #e8f4f8 0%, #d4e6f1 100%);
        border-radius: 8px;
        padding: 25px;
        margin-top: 20px;
      }

      .instructions h3 {
        color: #2c3e50;
        margin-top: 0;
      }

      .instructions ul {
        padding-left: 20px;
      }

      .instructions li {
        margin-bottom: 8px;
        color: #34495e;
      }

      .footer {
        background: #2c3e50;
        color: white;
        text-align: center;
        padding: 20px;
        margin-top: 40px;
      }

      @media (max-width: 768px) {
        .controls {
          justify-content: center;
        }

        .config-grid {
          grid-template-columns: 1fr;
        }

        .stats-panel {
          grid-template-columns: repeat(2, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ§§ é€šç”¨çº¢åŒ…é›¨ç»„ä»¶</h1>
        <p>é«˜æ€§èƒ½ã€è·¨æ¡†æ¶çš„çº¢åŒ…é›¨åŠ¨ç”»ç»„ä»¶æ¼”ç¤º</p>
      </div>

      <div class="content">
        <!-- ç»Ÿè®¡é¢æ¿ -->
        <div class="demo-section">
          <h2>ğŸ“Š å®æ—¶ç»Ÿè®¡</h2>
          <div class="stats-panel">
            <div class="stat-item">
              <div class="stat-value" id="fps">0</div>
              <div class="stat-label">FPS</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="collected">0</div>
              <div class="stat-label">å·²æ”¶é›†</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="totalValue">ï¿¥0</div>
              <div class="stat-label">æ€»ä»·å€¼</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="activeCount">0</div>
              <div class="stat-label">æ´»è·ƒçº¢åŒ…</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="performanceMode">é«˜è´¨é‡</div>
              <div class="stat-label">å½“å‰æ¨¡å¼</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="memoryUsage">0KB</div>
              <div class="stat-label">å†…å­˜ä½¿ç”¨</div>
            </div>
          </div>
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="demo-section">
          <h2>ğŸ® æ§åˆ¶é¢æ¿</h2>
          <div class="controls">
            <button class="btn btn-primary" id="startBtn">ğŸš€ å¼€å§‹</button>
            <button class="btn btn-secondary" id="stopBtn">â¹ï¸ åœæ­¢</button>
            <button class="btn btn-secondary" id="pauseBtn">â¸ï¸ æš‚åœ</button>
            <button class="btn btn-secondary" id="resumeBtn">â–¶ï¸ ç»§ç»­</button>
            <button class="btn btn-secondary" id="clearBtn">ğŸ§¹ æ¸…ç©º</button>
            <button class="btn btn-secondary" id="debugBtn">ğŸ› è°ƒè¯•æ¨¡å¼</button>
            <button class="btn btn-secondary" id="performanceBtn">
              âš¡ æ€§èƒ½æ¨¡å¼
            </button>
            <button class="btn btn-secondary" id="frameRateLimitBtn">
              ğŸ¯ å¸§ç‡é™åˆ¶
            </button>
          </div>
        </div>

        <!-- é…ç½®é¢æ¿ -->
        <div class="demo-section">
          <h2>âš™ï¸ é…ç½®è°ƒæ•´</h2>
          <div class="config-panel">
            <div class="config-grid">
              <div class="config-item">
                <label>çº¢åŒ…æ•°é‡</label>
                <input
                  type="range"
                  id="countRange"
                  min="5"
                  max="50"
                  value="15"
                />
                <span class="value" id="countValue">15</span>
              </div>
              <div class="config-item">
                <label>çº¢åŒ…å¯†åº¦</label>
                <input
                  type="range"
                  id="densityRange"
                  min="1"
                  max="10"
                  value="3"
                />
                <span class="value" id="densityValue">3</span>
              </div>
              <div class="config-item">
                <label>æœ€å°é€Ÿåº¦</label>
                <input
                  type="range"
                  id="minSpeedRange"
                  min="1"
                  max="5"
                  value="2"
                />
                <span class="value" id="minSpeedValue">2</span>
              </div>
              <div class="config-item">
                <label>æœ€å¤§é€Ÿåº¦</label>
                <input
                  type="range"
                  id="maxSpeedRange"
                  min="3"
                  max="10"
                  value="5"
                />
                <span class="value" id="maxSpeedValue">5</span>
              </div>
              <div class="config-item">
                <label>é«˜è´¨é‡å¸§ç‡</label>
                <input
                  type="range"
                  id="qualityFpsRange"
                  min="60"
                  max="240"
                  value="144"
                  step="1"
                />
                <span class="value" id="qualityFpsValue">144</span>
              </div>
            </div>
            <div
              class="config-note"
              style="
                margin-top: 15px;
                padding: 10px;
                background: #e8f4f8;
                border-radius: 6px;
                font-size: 14px;
                color: #2c3e50;
              "
            >
              <strong>ğŸ“ æ¨¡å¼è¯´æ˜:</strong>
              <br />ğŸ”§
              <strong>åŸºç¡€ä¼˜åŒ–ï¼š</strong>æ‰€æœ‰æ¨¡å¼éƒ½ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨ï¼Œç¡®ä¿å†…å­˜æ•ˆç‡
              <br />âš¡ <strong>æ€§èƒ½æ¨¡å¼ï¼š</strong>ç®€åŒ–æ¸²æŸ“ +
              60FPSé™åˆ¶ï¼Œè¿½æ±‚ç¨³å®šæ€§ <br />ğŸ¨
              <strong>é«˜è´¨é‡æ¨¡å¼ï¼š</strong>å®Œæ•´è§†è§‰æ•ˆæœ + è‡ªé€‚åº”å¸§ç‡ï¼Œè¿½æ±‚ç¾è§‚æ€§
              <br />ğŸ¯
              <strong>å¸§ç‡é™åˆ¶ï¼š</strong
              >å¯ä»¥å¼€å¯/å…³é—­å¸§ç‡é™åˆ¶ï¼Œå…³é—­åå°†è¿½æ±‚æœ€é«˜å¸§ç‡ <br />ğŸ›ï¸
              <strong>è‡ªå®šä¹‰å¸§ç‡ï¼š</strong
              >å¯ä»¥è°ƒæ•´é«˜è´¨é‡æ¨¡å¼çš„ç›®æ ‡å¸§ç‡ï¼ˆ60-240FPSï¼‰ <br />ğŸ“Š
              <strong>å¸§ç‡ç­–ç•¥ï¼š</strong> <br />&nbsp;&nbsp;&nbsp;&nbsp;â€¢
              <strong>ä¸¥æ ¼(98%)ï¼š</strong>ç²¾ç¡®æ§åˆ¶ï¼Œæ›´ç¨³å®šä½†å¯èƒ½ç•¥ä½äºç›®æ ‡
              <br />&nbsp;&nbsp;&nbsp;&nbsp;â€¢
              <strong>è‡ªé€‚åº”(90%)ï¼š</strong>å¹³è¡¡ç¨³å®šæ€§å’Œæ€§èƒ½ï¼Œæ¨èè®¾ç½®
              <br />&nbsp;&nbsp;&nbsp;&nbsp;â€¢
              <strong>å®½æ¾(80%)ï¼š</strong>æ›´å®¹æ˜“è¾¾åˆ°ç›®æ ‡FPSï¼Œä½†å¯èƒ½æœ‰æ³¢åŠ¨
              <br />ğŸ”
              <strong>å¸§ç‡è¯Šæ–­ï¼š</strong
              >å®æ—¶ç›‘æ§å¸§æ—¶é—´ã€æ¸²æŸ“æ•ˆç‡ï¼Œæ§åˆ¶å°è¾“å‡ºè¯¦ç»†ç»Ÿè®¡ <br />ğŸ–¥ï¸
              <strong>æ˜¾ç¤ºå™¨å…³ç³»ï¼š</strong
              >å¸§ç‡å—æ˜¾ç¤ºå™¨åˆ·æ–°ç‡é™åˆ¶ï¼Œä¼šè‡ªåŠ¨æ£€æµ‹å¹¶è°ƒæ•´å»ºè®®å€¼
            </div>

            <div
              class="config-note"
              style="
                margin-top: 10px;
                padding: 10px;
                background: #fff3cd;
                border-radius: 6px;
                font-size: 14px;
                color: #856404;
              "
            >
              <strong>ğŸ–¥ï¸ å¸§ç‡ä¸æ˜¾ç¤ºå™¨å…³ç³»:</strong>
              <br />â€¢ <strong>60Hzæ˜¾ç¤ºå™¨</strong> â†’
              æœ€é«˜æ˜¾ç¤º60FPSï¼ˆå³ä½¿è½¯ä»¶æ¸²æŸ“æ›´é«˜ï¼‰ <br />â€¢
              <strong>120Hzæ˜¾ç¤ºå™¨</strong> â†’
              æœ€é«˜æ˜¾ç¤º120FPSï¼ˆè¿™å°±æ˜¯ä¸ºä»€ä¹ˆçœ‹åˆ°120è€Œä¸æ˜¯144ï¼‰ <br />â€¢
              <strong>144Hzæ˜¾ç¤ºå™¨</strong> â†’ æœ€é«˜æ˜¾ç¤º144FPSï¼ˆå®Œç¾åŒ¹é…ï¼‰ <br />â€¢
              <strong>åŸç†</strong
              >ï¼šæµè§ˆå™¨VSyncè‡ªåŠ¨åŒæ­¥åˆ°æ˜¾ç¤ºå™¨åˆ·æ–°ç‡ï¼Œè¶…å‡ºéƒ¨åˆ†è¢«ä¸¢å¼ƒ <br />â€¢
              <strong>æµ‹è¯•</strong>ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹æ‚¨çš„æ˜¾ç¤ºå™¨å¹¶ç»™å‡ºæœ€ä¼˜å»ºè®®
            </div>
          </div>
        </div>

        <!-- çº¢åŒ…é›¨ç”»å¸ƒ -->
        <div class="demo-section">
          <h2>ğŸ¨ çº¢åŒ…é›¨å±•ç¤º</h2>
          <div class="canvas-container">
            <canvas id="redPacketCanvas" width="800" height="500"></canvas>
          </div>
        </div>

        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="instructions">
          <h3>ğŸ“– ä½¿ç”¨è¯´æ˜</h3>
          <ul>
            <li>ğŸ¯ ç‚¹å‡»çº¢åŒ…è¿›è¡Œæ”¶é›†ï¼Œæ¯ä¸ªçº¢åŒ…éƒ½æœ‰éšæœºçš„ä»·å€¼</li>
            <li>âš¡ é‡‘è‰²çº¢åŒ…ä¸ºç‰¹æ®Šçº¢åŒ…ï¼Œä»·å€¼æ›´é«˜</li>
            <li>ğŸ›ï¸ ä½¿ç”¨æ»‘å—å®æ—¶è°ƒæ•´çº¢åŒ…å‚æ•°</li>
            <li>ğŸ“Š è§‚å¯ŸFPSå’Œæ€§èƒ½ç»Ÿè®¡</li>
            <li>ğŸ“± æ”¯æŒè§¦æ‘¸è®¾å¤‡æ“ä½œ</li>
            <li>ğŸ› ç‚¹å‡»"è°ƒè¯•æ¨¡å¼"æŒ‰é’®æ˜¾ç¤ºçº¢åŒ…ç¢°æ’è¾¹ç•Œï¼ˆç»¿è‰²è™šçº¿æ¡†ï¼‰</li>
            <li>âš¡ ç‚¹å‡»"æ€§èƒ½æ¨¡å¼"æŒ‰é’®åˆ‡æ¢æ€§èƒ½æ¨¡å¼å’Œé«˜è´¨é‡æ¨¡å¼</li>
            <li>
              ğŸ” <strong>æ€§èƒ½æ¨¡å¼æµ‹è¯•</strong>ï¼šç®€åŒ–æ¸²æŸ“ã€60FPSé™åˆ¶ã€å¯¹è±¡æ± å¤ç”¨
            </li>
            <li>
              ğŸ¨
              <strong>é«˜è´¨é‡æ¨¡å¼æµ‹è¯•</strong
              >ï¼šå®Œæ•´è§†è§‰æ•ˆæœã€144FPSé™åˆ¶ã€å¯¹è±¡æ± å¤ç”¨
            </li>
            <li>
              ğŸ¯ <strong>å¸§ç‡é™åˆ¶å¼€å…³</strong>ï¼šç‚¹å‡»"ğŸ¯
              å¸§ç‡é™åˆ¶"æŒ‰é’®å¯å¼€å¯/å…³é—­å¸§ç‡é™åˆ¶
            </li>
            <li>
              ğŸ“Š <strong>å¸§ç‡ç­–ç•¥è°ƒèŠ‚</strong>ï¼šç‚¹å‡»"ğŸ“Š
              ç­–ç•¥"æŒ‰é’®åˆ‡æ¢å¸§ç‡æ§åˆ¶ç­–ç•¥ï¼ˆè‡ªé€‚åº”/å®½æ¾/ä¸¥æ ¼ï¼‰
            </li>
            <li>
              ğŸ›ï¸
              <strong>è‡ªå®šä¹‰å¸§ç‡</strong
              >ï¼šä½¿ç”¨"é«˜è´¨é‡å¸§ç‡"æ»‘å—è°ƒæ•´é«˜è´¨é‡æ¨¡å¼çš„ç›®æ ‡å¸§ç‡ï¼ˆ60-240FPSï¼‰
            </li>
            <li>ğŸ“ˆ è§‚å¯Ÿä¸åŒè®¾ç½®ä¸‹çš„å®é™…å¸§ç‡è¡¨ç°å’Œæ¸²æŸ“è´¨é‡å·®å¼‚</li>
            <li>
              ğŸ”
              <strong>å¸§ç‡è¯Šæ–­</strong
              >ï¼šFPSæ˜¾ç¤ºä¸º"å®é™…FPS/ç›®æ ‡FPS"æ ¼å¼ï¼Œæ§åˆ¶å°æ¯ç§’è¾“å‡ºè¯¦ç»†è¯Šæ–­
            </li>
            <li>
              ğŸ–¥ï¸
              <strong>æ˜¾ç¤ºå™¨æ£€æµ‹</strong
              >ï¼šè‡ªåŠ¨æ£€æµ‹æ˜¾ç¤ºå™¨åˆ·æ–°ç‡ï¼Œå¸®åŠ©è¯Šæ–­å¸§ç‡é™åˆ¶åŸå› 
            </li>
            <li>
              âš ï¸
              <strong>æ³¨æ„</strong
              >ï¼šå…³é—­å¸§ç‡é™åˆ¶ä¼šè¿½æ±‚æœ€é«˜å¸§ç‡ï¼Œå¯èƒ½å¯¼è‡´é«˜CPUä½¿ç”¨ç‡
            </li>
            <li>ğŸ’» æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹è¯¦ç»†çš„æ€§èƒ½ä¿¡æ¯å’Œç»Ÿè®¡</li>
          </ul>
        </div>
      </div>
    </div>

    <script type="module">
      import { RedPacketRainEngine } from "./dist-core/RedPacketRainEngine.esm.js";
      // åˆå§‹åŒ–çº¢åŒ…é›¨
      const canvas = document.getElementById("redPacketCanvas");

      // ç¡®ä¿Canvaså°ºå¯¸æ­£ç¡®è®¾ç½®
      const resizeCanvas = () => {
        const container = canvas.parentElement;
        const rect = container.getBoundingClientRect();
        canvas.width = 800;
        canvas.height = 500;
        canvas.style.width = "100%";
        canvas.style.height = "500px";
      };
      resizeCanvas();

      // æ¨¡æ‹Ÿçº¢åŒ…æ•°æ®
      const mockRedPackets = [
        { id: "id1", myFlag: true, value: 100 }, // ç‰¹æ®Šçº¢åŒ…
        { id: "id2", myFlag: false, value: 20 },
        { id: "id3", myFlag: true, value: 150 }, // ç‰¹æ®Šçº¢åŒ…
        { id: "id4", myFlag: false, value: 30 },
        { id: "id5", myFlag: false, value: 200 },
        { id: "id6", myFlag: true, value: 50 }, // ç‰¹æ®Šçº¢åŒ…
        { id: "id7", myFlag: false, value: 80 },
        { id: "id8", myFlag: false, value: 60 },
        { id: "id9", myFlag: true, value: 120 }, // ç‰¹æ®Šçº¢åŒ…
        { id: "id10", myFlag: false, value: 40 },
      ];

      const engine = new RedPacketRainEngine(canvas, {
        containerWidth: 800,
        containerHeight: 500,
        enablePerformanceMode: true, // é»˜è®¤å¯ç”¨æ€§èƒ½æ¨¡å¼
        maxFPS: 60, // æ€§èƒ½æ¨¡å¼å¸§ç‡
        qualityMaxFPS: 144, // é«˜è´¨é‡æ¨¡å¼å¸§ç‡
        enableFrameRateLimit: true, // é»˜è®¤å¯ç”¨å¸§ç‡é™åˆ¶
        redPackets: mockRedPackets,
        isSpecialFn: "myFlag",
        isParticle: true,
      });
      // è®¾ç½®ç²’å­é…ç½®
      engine.setParticleConfig({
        count: 20, // ç²’å­æ•°é‡
        colors: ["#000000",'#008c8c'], // è‡ªå®šä¹‰é¢œè‰²
        gravity: 0.5, // é‡åŠ›å¼ºåº¦
      });

      window.addEventListener("resize", resizeCanvas);

      // æ§åˆ¶æŒ‰é’®äº‹ä»¶
      document
        .getElementById("startBtn")
        .addEventListener("click", () => engine.start());
      document
        .getElementById("stopBtn")
        .addEventListener("click", () => engine.stop());
      document
        .getElementById("pauseBtn")
        .addEventListener("click", () => engine.pause());
      document
        .getElementById("resumeBtn")
        .addEventListener("click", () => engine.resume());
      document
        .getElementById("clearBtn")
        .addEventListener("click", () => engine.clear());

      // è°ƒè¯•æ¨¡å¼åˆ‡æ¢
      const debugBtn = document.getElementById("debugBtn");
      debugBtn.addEventListener("click", () => {
        engine.updateConfig({ debugMode: !engine.config.debugMode });
        debugBtn.textContent = engine.config.debugMode
          ? "ğŸ› å…³é—­è°ƒè¯•"
          : "ğŸ› è°ƒè¯•æ¨¡å¼";
        debugBtn.classList.toggle("btn-primary", engine.config.debugMode);
        debugBtn.classList.toggle("btn-secondary", !engine.config.debugMode);
        console.log("è°ƒè¯•æ¨¡å¼:", engine.config.debugMode ? "å¼€å¯" : "å…³é—­");
      });

      // æ€§èƒ½æ¨¡å¼åˆ‡æ¢
      const performanceBtn = document.getElementById("performanceBtn");
      const initialPerformanceMode = engine.config.enablePerformanceMode;
      performanceBtn.textContent = initialPerformanceMode
        ? "âš¡ é«˜è´¨é‡æ¨¡å¼"
        : "âš¡ æ€§èƒ½æ¨¡å¼";
      performanceBtn.classList.toggle("btn-primary", initialPerformanceMode);
      performanceBtn.classList.toggle("btn-secondary", !initialPerformanceMode);

      // å¸§ç‡é™åˆ¶åˆ‡æ¢
      const frameRateLimitBtn = document.getElementById("frameRateLimitBtn");
      const initialFrameRateLimit = engine.config.enableFrameRateLimit;
      frameRateLimitBtn.textContent = initialFrameRateLimit
        ? "ğŸ¯ å…³é—­é™åˆ¶"
        : "ğŸ¯ å¯ç”¨é™åˆ¶";
      frameRateLimitBtn.classList.toggle("btn-primary", initialFrameRateLimit);
      frameRateLimitBtn.classList.toggle(
        "btn-secondary",
        !initialFrameRateLimit
      );
      frameRateLimitBtn.addEventListener("click", () => {
        engine.config.enableFrameRateLimit =
          !engine.config.enableFrameRateLimit;
        const isEnabled = engine.config.enableFrameRateLimit;
        frameRateLimitBtn.textContent = isEnabled
          ? "ğŸ¯ å…³é—­é™åˆ¶"
          : "ğŸ¯ å¯ç”¨é™åˆ¶";
        frameRateLimitBtn.classList.toggle("btn-primary", isEnabled);
        frameRateLimitBtn.classList.toggle("btn-secondary", !isEnabled);
        console.log("å¸§ç‡é™åˆ¶:", isEnabled ? "å·²å¯ç”¨" : "å·²å…³é—­");
        if (!isEnabled) {
          console.log(
            "âš ï¸ æ³¨æ„ï¼šå…³é—­å¸§ç‡é™åˆ¶åå°†è¿½æ±‚æœ€é«˜å¸§ç‡ï¼Œå¯èƒ½å¯¼è‡´é«˜CPUä½¿ç”¨ç‡"
          );
        }
      });
      performanceBtn.addEventListener("click", () => {
        const isPerformanceMode = !engine.getPerformanceMode();
        engine.setPerformanceMode(isPerformanceMode);
        performanceBtn.textContent = isPerformanceMode
          ? "âš¡ é«˜è´¨é‡æ¨¡å¼"
          : "âš¡ æ€§èƒ½æ¨¡å¼";
        performanceBtn.classList.toggle("btn-primary", isPerformanceMode);
        performanceBtn.classList.toggle("btn-secondary", !isPerformanceMode);
        const perfInfo = engine.getStats ? engine.getStats() : {};
        console.log("æ€§èƒ½ä¿¡æ¯:", perfInfo);
        console.log(
          `å½“å‰å¸§ç‡é™åˆ¶: ${
            engine.config.enablePerformanceMode
              ? engine.config.maxFPS
              : engine.config.qualityMaxFPS
          }FPS`
        );
        console.log(
          "æ³¨æ„: å¯¹è±¡æ± å¤ç”¨åœ¨æ‰€æœ‰æ¨¡å¼ä¸‹éƒ½å¯ç”¨ï¼Œä¸¤ç§æ¨¡å¼éƒ½æœ‰å¸§ç‡æ§åˆ¶ï¼ˆæ€§èƒ½æ¨¡å¼60FPSï¼Œé«˜è´¨é‡æ¨¡å¼144FPSï¼‰"
        );
        if (
          !isPerformanceMode &&
          (engine.config.qualityMaxFPS === 144 ||
            engine.config.qualityMaxFPS === 120)
        ) {
          console.log(
            "âš ï¸ æ³¨æ„ï¼šå¦‚æœå¸§ç‡åœç•™åœ¨120FPSï¼Œå¯èƒ½æ˜¯æ‚¨çš„æ˜¾ç¤ºå™¨åˆ·æ–°ç‡é™åˆ¶"
          );
          console.log("ğŸ’¡ å»ºè®®ï¼šå°è¯•å…³é—­å¸§ç‡é™åˆ¶æ¥æµ‹è¯•è®¾å¤‡çš„çœŸå®å¸§ç‡èƒ½åŠ›");
        }
      });

      // é…ç½®æ§åˆ¶äº‹ä»¶
      const setupRangeControl = (rangeId, valueId, configKey) => {
        const range = document.getElementById(rangeId);
        const value = document.getElementById(valueId);
        range.addEventListener("input", (e) => {
          const val = parseInt(e.target.value);
          value.textContent = val;
          if (configKey === "count") {
            engine.updateConfig({ count: val });
          } else if (configKey === "density") {
            engine.updateConfig({ density: val });
          } else if (configKey === "minSpeed") {
            engine.updateConfig({
              speed: { ...engine.config.speed, min: val },
            });
          } else if (configKey === "maxSpeed") {
            engine.updateConfig({
              speed: { ...engine.config.speed, max: val },
            });
          }
        });
      };
      setupRangeControl("countRange", "countValue", "count");
      setupRangeControl("densityRange", "densityValue", "density");
      setupRangeControl("minSpeedRange", "minSpeedValue", "minSpeed");
      setupRangeControl("maxSpeedRange", "maxSpeedValue", "maxSpeed");

      // é«˜è´¨é‡æ¨¡å¼å¸§ç‡æ§åˆ¶
      const qualityFpsRange = document.getElementById("qualityFpsRange");
      const qualityFpsValue = document.getElementById("qualityFpsValue");
      qualityFpsRange.addEventListener("input", (e) => {
        const val = parseInt(e.target.value);
        qualityFpsValue.textContent = val;
        engine.config.qualityMaxFPS = val;
        console.log(`é«˜è´¨é‡æ¨¡å¼å¸§ç‡å·²è®¾ç½®ä¸º: ${val}FPS`);
        if (!engine.config.enablePerformanceMode) {
          console.log(`âš¡ å½“å‰é«˜è´¨é‡æ¨¡å¼å°†å°è¯•è¾¾åˆ° ${val}FPS`);
          if (val > 120) {
            console.log(
              "âš ï¸ æ³¨æ„ï¼šå¦‚æœæ‚¨çš„æ˜¾ç¤ºå™¨æ˜¯120Hzï¼Œå®é™…å¸§ç‡å¯èƒ½è¢«é™åˆ¶åœ¨120FPS"
            );
          }
        }
      });

      // æ£€æµ‹æ˜¾ç¤ºå™¨åˆ·æ–°ç‡
      const detectRefreshRate = () => {
        let frameCount = 0;
        const startTime = performance.now();
        const detectFrame = (currentTime) => {
          frameCount++;
          if (currentTime - startTime >= 1000) {
            const detectedFPS = frameCount;
          } else {
            requestAnimationFrame(detectFrame);
          }
        };
        requestAnimationFrame(detectFrame);
      };
      setTimeout(detectRefreshRate, 1000);

      // ç»Ÿè®¡é¢æ¿è”åŠ¨ï¼ˆå‡è®¾çœŸå®å¼•æ“æœ‰äº‹ä»¶æˆ–æ–¹æ³•è·å–ç»Ÿè®¡æ•°æ®ï¼‰
      function updateStatsPanel() {
        // æ€§èƒ½ç»Ÿè®¡
        const stats = engine.getStats ? engine.getStats() : {};
        // æ”¶é›†ç»Ÿè®¡
        const collection = engine.getCollectionStats
          ? engine.getCollectionStats()
          : {};
        // æ€§èƒ½æ¨¡å¼
        const isPerformance = engine.getPerformanceMode
          ? engine.getPerformanceMode()
          : false;
        // å¸§ç‡ç­–ç•¥
        const strategy = engine.config.frameRateStrategy || "adaptive";
        // å†…å­˜ä¼°ç®—
        const memoryUsage =
          (((engine.poolSize || 50) * 200) / 1024).toFixed(1) + "KB";

        document.getElementById("fps").textContent = stats.fps ?? 0;
        document.getElementById("collected").textContent =
          collection.totalCollected ?? 0;
        document.getElementById("totalValue").textContent = `ï¿¥${
          collection.totalValue ?? 0
        }`;
        document.getElementById("activeCount").textContent =
          stats.activeRedPackets ?? 0;
        document.getElementById("performanceMode").textContent =
          (isPerformance ? "æ€§èƒ½æ¨¡å¼" : "é«˜è´¨é‡") + `(${strategy}ç­–ç•¥)`;
        document.getElementById("memoryUsage").textContent = memoryUsage;
      }
      // å¦‚æœæœ‰äº‹ä»¶/å›è°ƒå¯ç”¨ï¼Œå»ºè®®å®šæ—¶åˆ·æ–°ç»Ÿè®¡é¢æ¿
      setInterval(updateStatsPanel, 500);

      // // è‡ªåŠ¨å¼€å§‹
      engine.start();
    </script>
  </body>
</html>
